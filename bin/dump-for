#!/usr/bin/env ruby
require File.dirname(__FILE__) + "/../lib/geordi"
include Geordi

catching_errors do
  retrieve_data!
  
  command = %(ssh #{user}@#{server} -t "cd #{path} && dumple #{env} --for_download")
  success = system command
  
  if success
    puts "Downloading dump_for_download..."
    system "scp #{user}@#{server}:~/dumps/dump_for_download.dump #{root}/tmp/#{env}.dump"
    puts
    puts "Dumped the #{env.upcase} database to: #{File.basename root}/tmp/#{env}.dump"
  else
    raise "An error occurred. Aborting..."
  end
end
